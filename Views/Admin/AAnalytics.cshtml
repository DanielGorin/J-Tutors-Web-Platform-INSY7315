@model J_Tutors_Web_Platform.ViewModels.AnalyticsViewModel

@{
    ViewData["Title"] = "Analytics";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["NavSection"] = "Admin";
}

<!-- Scoped styles for AAnalytics only -->
<style>
    .aanalytics, .aanalytics .card {
        color: var(--text-color) !important;
    }

        .aanalytics .caption, .aanalytics .text-muted {
            color: var(--muted-text-color) !important;
        }

        .aanalytics .form-control, .aanalytics .form-select {
            background-color: var(--surface-color) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
            padding: 10px 12px !important;
            width: 100%;
        }

            .aanalytics .form-control::placeholder {
                color: var(--muted-text-color) !important;
            }

            .aanalytics .form-control:focus, .aanalytics .form-select:focus {
                outline: none !important;
                border-color: var(--primary-color) !important;
                box-shadow: 0 0 0 0.15rem var(--accent-color) !important;
            }

        /* KPI card layout */
        .aanalytics .kpi {
            display: flex;
            flex-direction: column;
            gap: 6px;
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            height: 100%;
        }

            .aanalytics .kpi .label {
                font-size: 14px;
                color: var(--muted-text-color);
            }

            .aanalytics .kpi .value {
                font-weight: 700;
                font-size: 24px;
            }

            .aanalytics .kpi .sub {
                font-size: 12px;
                color: var(--muted-text-color);
            }

        /* Simple bar charts (CSS only) */
        .aanalytics .bars {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .aanalytics .bar-row {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 12px;
            align-items: center;
        }

        .aanalytics .bar-label {
            font-size: 14px;
        }

        .aanalytics .bar-track {
            position: relative;
            height: 10px;
            border-radius: 999px;
            background: var(--border-color);
            overflow: hidden;
            min-width: 160px;
        }

        .aanalytics .bar-fill {
            height: 100%;
            width: 0%;
            background: var(--primary-color);
            transition: width 600ms ease;
        }

        .aanalytics .bar-value {
            font-size: 14px;
        }

        /* Month chart (horizontal bars) */
        .aanalytics .month-bars .bar-label {
            width: 88px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .aanalytics .month-bars .bar-row {
            grid-template-columns: 120px 1fr auto;
        }

        /* Table theme (if needed later) */
        .aanalytics .table, .aanalytics .table th, .aanalytics .table td {
            color: var(--text-color) !important;
            background: transparent !important;
            border-color: var(--border-color) !important;
            vertical-align: middle;
        }

            .aanalytics .table thead th {
                border-bottom: 1px solid var(--border-color) !important;
            }

        /* Page header */
        .aanalytics .page-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
</style>

<div class="aanalytics">

    <!-- Header -->
    <div class="page-head mb-16">
        <h1 class="mb-0">Analytics</h1>
        <a asp-controller="Admin" asp-action="ADashboard" class="btn btn-secondary">← Back to Dashboard</a>
    </div>

    <!-- KPI Row -->
    <div class="row g-3 mb-16">
        <div class="col-sm-6 col-lg-3">
            <div class="kpi shadow">
                <div class="label">Points in Circulation</div>
                <div class="value">@Model.GlobalPoints</div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="kpi shadow">
                <div class="label">Avg Event Attendance</div>
                <div class="value">@Model.AverageAttendance %</div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="kpi shadow">
                <div class="label">This Months Earnings</div>
                <div class="value">R @Model.MonthlyEarnings</div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="kpi shadow">
                <div class="label">Unpaid Sessions (Total)</div>
                <div class="value">R @Model.AmountUnpaid</div>
            </div>
        </div>
    </div>
</div>


@* --------------------------------------------------------------------
   TODO: Wire Up AAnalytics
   - Replace DEMO DATA with real aggregates:
     • Points in circulation (windowed)
     • Avg event attendance (windowed)
     • Income by month, unpaid total
     • Top subjects by users & sessions
     • Tutoring hours per month
   - Filters → query backend; update all cards/charts
   - Export buttons → generate Tactical / Strategic PDF reports
   - Drilldowns:
     • Users/Subjects → Admin.AUsers with filters
     • Sessions/Income → Admin.ASessions with date filters
     • Events/Attendance → Admin.AEvents with date filters
   - Auth guard: admin-only
--------------------------------------------------------------------- *@
