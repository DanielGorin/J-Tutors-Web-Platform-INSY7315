@{
    ViewData["Title"] = "Admin Files";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["NavSection"] = "Admin";
}

<!-- Scoped styles for Admin Files -->
<style>
    .afiles, .afiles .card {
        color: var(--text-color) !important;
    }

        .afiles .caption, .afiles .text-muted {
            color: var(--muted-text-color) !important;
        }

        .afiles .form-control, .afiles .form-select, .afiles textarea {
            background-color: var(--surface-color) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
            padding: 10px 12px !important;
            width: 100%;
        }

            .afiles .form-control::placeholder, .afiles textarea::placeholder {
                color: var(--muted-text-color) !important;
            }

            .afiles .form-control:focus, .afiles .form-select:focus, .afiles textarea:focus {
                outline: none !important;
                border-color: var(--primary-color) !important;
                box-shadow: 0 0 0 0.15rem var(--accent-color) !important;
            }

        /* Table theme */
        .afiles .table, .afiles .table th, .afiles .table td {
            color: var(--text-color) !important;
            background: transparent !important;
            border-color: var(--border-color) !important;
            vertical-align: middle;
        }

            .afiles .table thead th {
                border-bottom: 1px solid var(--border-color) !important;
            }

            .afiles .table tbody tr + tr {
                border-top: 1px solid var(--border-color) !important;
            }

            .afiles .table tbody tr:hover {
                background: rgba(0,0,0,0.03);
            }

        /* Chips / Badges */
        .afiles .badge-chip {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            border: 1px solid var(--border-color);
            white-space: nowrap;
        }

        .afiles .badge-active {
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .afiles .badge-soon {
            border-color: var(--warning-color);
            color: var(--warning-color);
        }

        .afiles .badge-expired {
            border-color: var(--error-color);
            color: var(--error-color);
        }

        /* Upload drop zone (visual only) */
        .afiles .drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            background: var(--surface-color);
        }

            .afiles .drop-zone:hover {
                border-color: var(--primary-color);
            }

        /* Modal list items */
        .afiles .access-item {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 8px;
            background: var(--surface-color);
        }
</style>

<div class="afiles">
    <!-- Header / Back -->
    <div class="d-flex justify-content-between align-items-center mb-16">
        <h1 class="mb-0">Files (Admin)</h1>
        <a asp-controller="Admin" asp-action="ADashboard" class="btn btn-secondary">← Back to Dashboard</a>
    </div>

    <div class="row g-3">
        <!-- LEFT: Library (filters + table) -->
        <div class="col-lg-8">
            <div class="card shadow p-24 mb-16">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label" for="fileSearch">Search</label>
                        <input id="fileSearch" class="form-control" placeholder="Search by name or description" />
                    </div>
                    <div class="col-6 col-md-3">
                        <label class="form-label" for="fileSort">Sort by</label>
                        <select id="fileSort" class="form-select">
                            <option value="uploaded">Uploaded</option>
                            <option value="name">Name</option>
                            <option value="size">Size</option>
                            <option value="expiry">Expiry</option>
                        </select>
                    </div>
                    <div class="col-6 col-md-3 d-flex align-items-end">
                        <div class="form-check">
                            <input id="showExpired" class="form-check-input" type="checkbox" />
                            <label for="showExpired" class="form-check-label">Show expired</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow p-24">
                <div class="table-responsive">
                    <table class="table align-middle">
                        <thead>
                            <tr>
                                <th>File</th>
                                <th>Size</th>
                                <th>Uploaded</th>
                                <th>Expires</th>
                                <th>Access</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @* ===== DEMO DATA — replace/remove when wiring ===== *@
                            <tr>
                                <td>
                                    <div class="d-flex flex-column">
                                        <strong>File 1.pdf</strong>
                                        <span class="caption">Description: What this file contains. The quick brown fox jumped over the lazy dog.</span>
                                    </div>
                                </td>
                                <td>1.2 MB</td>
                                <td>2025-09-25</td>
                                <td><span class="badge-chip badge-active">Active · 12 days left</span></td>
                                <td class="caption">5 students</td>
                                <td class="text-end">
                                    <a class="btn btn-sm btn-outline-primary" download>Download</a>
                                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#manageAccessModal">Manage Access</button>
                                    <button class="btn btn-sm btn-outline-secondary" disabled>Delete</button>
                                </td>
                            </tr>

                            <tr>
                                <td>
                                    <div class="d-flex flex-column">
                                        <strong>File 2.docx</strong>
                                        <span class="caption">Description: What this file contains. The quick brown fox jumped over the lazy dog.</span>
                                    </div>
                                </td>
                                <td>860 KB</td>
                                <td>2025-09-21</td>
                                <td><span class="badge-chip badge-soon">Expires in 3 days</span></td>
                                <td class="caption">2 students</td>
                                <td class="text-end">
                                    <a class="btn btn-sm btn-outline-primary" download>Download</a>
                                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#manageAccessModal">Manage Access</button>
                                    <button class="btn btn-sm btn-outline-secondary" disabled>Delete</button>
                                </td>
                            </tr>

                            <tr>
                                <td>
                                    <div class="d-flex flex-column">
                                        <strong>File 3.pptx</strong>
                                        <span class="caption">Description: What this file contains. The quick brown fox jumped over the lazy dog.</span>
                                    </div>
                                </td>
                                <td>4.7 MB</td>
                                <td>2025-08-30</td>
                                <td><span class="badge-chip badge-expired">Expired</span></td>
                                <td class="caption">0 students</td>
                                <td class="text-end">
                                    <a class="btn btn-sm btn-outline-primary" download>Download</a>
                                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#manageAccessModal">Manage Access</button>
                                    <button class="btn btn-sm btn-outline-secondary" disabled>Delete</button>
                                </td>
                            </tr>
                            @* ===== /DEMO DATA ================================ *@

                            @* Empty state example:
                            <tr>
                            <td colspan="6">
                            <div class="text-center p-24 text-muted">No files to show.</div>
                            </td>
                            </tr>
                            *@
                        </tbody>
                    </table>
                </div>

                <!-- Pagination placeholder -->
                <div class="d-flex justify-content-between align-items-center mt-16">
                    <div class="caption text-muted">Showing 3 of 3</div>
                    <div>
                        <button class="btn btn-outline-secondary btn-sm" disabled>Previous</button>
                        <button class="btn btn-outline-secondary btn-sm" disabled>Next</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT: Upload + Tips -->
        <div class="col-lg-4">
            <div class="card shadow p-24 mb-16">
                <h3 class="mb-8">Upload New File</h3>
                <div class="drop-zone mb-12">
                    <div class="caption mb-8">Drag &amp; drop to upload</div>
                    <input type="file" class="form-control" />
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-primary" disabled>Upload</button>
                    <button class="btn btn-outline-secondary" disabled>Clear</button>
                </div>
                <div class="caption mt-8">Supported: PDF, DOCX, PPTX, XLSX, Images (UI-only for now).</div>
            </div>

            <div class="card shadow p-24">
                <h3 class="mb-8">Access Tips</h3>
                <ul class="mb-0">
                    <li class="mb-8">Use <em>Manage Access</em> to choose students and set expiry windows.</li>
                    <li class="mb-8">Expired access should block downloads automatically (future).</li>
                    <li class="mb-0">Auditing of downloads will appear here in future.</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Manage Access Modal (Bootstrap) -->
<div class="modal fade" id="manageAccessModal" tabindex="-1" aria-labelledby="manageAccessModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content" style="background: var(--surface-color); color: var(--text-color); border-color: var(--border-color);">
            <div class="modal-header" style="border-bottom-color: var(--border-color);">
                <h5 class="modal-title" id="manageAccessModalLabel">Manage Access — <span class="caption">File 1.pdf</span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                        style="filter: invert(var(--btn-close-invert,0));"></button>
            </div>
            <div class="modal-body">
                <div class="mb-12">
                    <label class="form-label">Quick Search</label>
                    <input class="form-control" placeholder="Search students (UI only)" />
                </div>

                @* ===== DEMO DATA: Students with per-user expiry ===== *@
                <div class="access-item d-flex justify-content-between align-items-center">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="s1" checked>
                        <label class="form-check-label" for="s1"><strong>Student 1</strong></label>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <label class="caption mb-0" for="s1exp">Expires</label>
                        <input id="s1exp" type="date" class="form-control" style="max-width: 170px;">
                    </div>
                </div>

                <div class="access-item d-flex justify-content-between align-items-center">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="s2">
                        <label class="form-check-label" for="s2"><strong>Student 2</strong></label>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <label class="caption mb-0" for="s2exp">Expires</label>
                        <input id="s2exp" type="date" class="form-control" style="max-width: 170px;">
                    </div>
                </div>

                <div class="access-item d-flex justify-content-between align-items-center">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="s3" checked>
                        <label class="form-check-label" for="s3"><strong>Student 3</strong></label>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <label class="caption mb-0" for="s3exp">Expires</label>
                        <input id="s3exp" type="date" class="form-control" style="max-width: 170px;">
                    </div>
                </div>

                <div class="access-item d-flex justify-content-between align-items-center">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="s4">
                        <label class="form-check-label" for="s4"><strong>Student 4</strong></label>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <label class="caption mb-0" for="s4exp">Expires</label>
                        <input id="s4exp" type="date" class="form-control" style="max-width: 170px;">
                    </div>
                </div>
                @* ===== /DEMO DATA ================================ *@
            </div>
            <div class="modal-footer" style="border-top-color: var(--border-color);">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" disabled>Save Changes</button>
            </div>
        </div>
    </div>
</div>

@* --------------------------------------------------------------------
   TODO: Wire Up Admin Files
   - List files from storage (name, size, uploadedAt, expiresAt, description)
   - Upload flow (POST + progress); validate types/size; store metadata
   - Download endpoint with audit log (who, when)
   - Delete with confirm; soft-delete or hard-delete policy
   - Manage Access:
       • Load students
       • Toggle access per student; set per-user expiry
       • Persist and enforce expiry windows on download
   - Filters: search, sort, show expired
   - Pagination: server-driven
   - Security: admin-only guard
--------------------------------------------------------------------- *@
