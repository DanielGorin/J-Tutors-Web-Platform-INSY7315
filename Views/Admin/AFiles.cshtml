@model J_Tutors_Web_Platform.ViewModels.AFilesViewModel

@{
    ViewData["Title"] = "Admin Files";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["NavSection"] = "Admin";
}

<!-- Scoped styles for Admin Files -->
<style>
    .afiles, .afiles .card {
        color: var(--text-color) !important;
    }

        .afiles .caption, .afiles .text-muted {
            color: var(--muted-text-color) !important;
        }

        .afiles .form-control, .afiles .form-select, .afiles textarea {
            background-color: var(--surface-color) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
            padding: 10px 12px !important;
            width: 100%;
        }

            .afiles .form-control::placeholder, .afiles textarea::placeholder {
                color: var(--muted-text-color) !important;
            }

            .afiles .form-control:focus, .afiles .form-select:focus, .afiles textarea:focus {
                outline: none !important;
                border-color: var(--primary-color) !important;
                box-shadow: 0 0 0 0.15rem var(--accent-color) !important;
            }

        /* Table theme */
        .afiles .table, .afiles .table th, .afiles .table td {
            color: var(--text-color) !important;
            background: transparent !important;
            border-color: var(--border-color) !important;
            vertical-align: middle;
        }

            .afiles .table thead th {
                border-bottom: 1px solid var(--border-color) !important;
            }

            .afiles .table tbody tr + tr {
                border-top: 1px solid var(--border-color) !important;
            }

            .afiles .table tbody tr:hover {
                background: rgba(0,0,0,0.03);
            }

        /* Chips / Badges */
        .afiles .badge-chip {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            border: 1px solid var(--border-color);
            white-space: nowrap;
        }

        .afiles .badge-active {
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .afiles .badge-soon {
            border-color: var(--warning-color);
            color: var(--warning-color);
        }

        .afiles .badge-expired {
            border-color: var(--error-color);
            color: var(--error-color);
        }

        /* Upload drop zone (visual only) */
        .afiles .drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            background: var(--surface-color);
        }

            .afiles .drop-zone:hover {
                border-color: var(--primary-color);
            }

        /* Modal list items */
        .afiles .access-item {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 8px;
            background: var(--surface-color);
        }
</style>

<div class="afiles">
    <!-- Header / Back -->
    <div class="d-flex justify-content-between align-items-center mb-16">
        <h1 class="mb-0">Files (Admin)</h1>
        <a asp-controller="Admin" asp-action="ADashboard" class="btn btn-secondary">← Back to Dashboard</a>
    </div>

    <div class="row g-3">
            <div class="card shadow p-24">
                <div class="table-responsive">
                    <table class="table align-middle">
                        <thead>
                            <tr>
                                <th>File</th>
                                <th>Added by</th>
                                <th>Users with access</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var file in Model.FSR) //not completed
                            {
                                <tr>
                                    <td>
                                        <div class="d-flex flex-column">
                                            <strong>@file.FileName</strong>
                                        </div>
                                    </td>
                                    <td class="text-center"><span class="badge-chip badge-active">@file.AdminUsername</span></td>
                                    <td class="text-center"><span class="badge-chip badge-active">@file.UserCount</span></td>
                                    <td class="text-end">
                                        <a class="btn btn-outline-primary btn-sm" asp-action="FileShareDownload" asp-route-name="@file.FileName">Download</a>
                                        <form asp-action="ManageAccess" asp-controller="Test">
                                            <input type="hidden" name="fileName" value="@file.FileName" />
                                            <button type="submit" class="btn btn-sm btn-outline-primary mt-2">Manage Access</button>
                                        </form>
                                        <form asp-action="DeleteFile" asp-controller="Test">
                                            <input type="hidden" name="fileName" value="@file.FileName"/>
                                            <button type="submit" class="btn btn-sm btn-outline-danger mt-2">Delete</button>
                                        </form>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <!-- Pagination placeholder -->
                <div class="d-flex justify-content-between align-items-center mt-16">
                    <div class="caption text-muted">Showing 3 of 3</div>
                    <div>
                        <button class="btn btn-outline-secondary btn-sm" disabled>Previous</button>
                        <button class="btn btn-outline-secondary btn-sm" disabled>Next</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT: Upload + Tips -->
        <div class="col-lg-4">
            <div class="card shadow p-24 mb-16">
                <form asp-action="FileShareUpload" method="post" enctype="multipart/form-data" class="mb-3">
                    <div class="drop-zone mb-12">
                        <input type="file" name="file" class="form-control" />
                        <button class="btn btn-primary mt-2" type="submit">Upload</button>
                    </div>
                </form>
            </div>

            <div class="card shadow p-24">
                <h3 class="mb-8">Access Tips</h3>
                <ul class="mb-0">
                    <li class="mb-8">Use <em>Manage Access</em> to choose students and set expiry windows.</li>
                    <li class="mb-8">Expired access should block downloads automatically (future).</li>
                    <li class="mb-0">Auditing of downloads will appear here in future.</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@* --------------------------------------------------------------------
   TODO: Wire Up Admin Files
   - Download endpoint with audit log (who, when) - partical completetion, delete possible without audit
   - Delete with confirm; soft-delete or hard-delete policy
   - Manage Access:
       • create manage access view, list user with access to a specific file (in prog)
   - Filters: search, sort, show expired
   - Pagination: server-driven
   - Security: admin-only guard
--------------------------------------------------------------------- *@
