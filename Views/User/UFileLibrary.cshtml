@model J_Tutors_Web_Platform.ViewModels.AFilesViewModel
@using J_Tutors_Web_Platform.Models.Shared

@{
    ViewData["Title"] = "File Library";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["NavSection"] = "User";
}

<!-- Scoped styles for File Library only -->
<style>
    .filelib .form-control, .filelib select {
        background-color: var(--surface-color) !important;
        color: var(--text-color) !important;
        border: 1px solid var(--border-color) !important;
        border-radius: 8px !important;
        padding: 10px 12px !important;
        width: 100%;
    }

        .filelib .form-control::placeholder {
            color: var(--muted-text-color) !important;
        }

        .filelib .form-control:focus, .filelib select:focus {
            outline: none !important;
            border-color: var(--primary-color) !important;
            box-shadow: 0 0 0 0.15rem var(--accent-color) !important;
        }

    /* Badge styles for expiry */
    .filelib .badge-chip {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid var(--border-color);
    }

    .filelib .badge-active {
        border-color: var(--success-color);
        color: var(--success-color);
    }

    .filelib .badge-soon {
        border-color: var(--warning-color);
        color: var(--warning-color);
    }

    .filelib .badge-expired {
        border-color: var(--error-color);
        color: var(--error-color);
    }

    /* Dark-mode legibility: scope to this page */
    .filelib, .filelib .card {
        color: var(--text-color) !important;
    }

        .filelib .caption,
        .filelib .text-muted {
            color: var(--muted-text-color) !important;
        }

        .filelib .table,
        .filelib .table th,
        .filelib .table td {
            color: var(--text-color) !important;
            background-color: transparent !important;
            border-color: var(--border-color) !important;
        }

            .filelib .table thead th {
                border-bottom: 1px solid var(--border-color) !important;
            }

            .filelib .table tbody tr + tr {
                border-top: 1px solid var(--border-color) !important;
            }

            /* Optional subtle hover that works in both themes */
            .filelib .table tbody tr:hover {
                background: rgba(0,0,0,0.03);
            }
</style>

<div class="filelib">

    <div class="d-flex justify-content-between align-items-center mb-16">
        <h1 class="mb-0">File Library</h1>
        <a asp-controller="Home" asp-action="Dashboard" class="btn btn-secondary">← Back to Dashboard</a>
    </div>

    <div class="card shadow p-24">
        <!-- Controls: Search + Filters -->
        <div class="row mb-16">
            <div class="col-md-6 mb-8">
                <label for="searchFiles" class="form-label">Search files</label>
                <input id="searchFiles" type="text" class="form-control" placeholder="Search by name or description" />
            </div>
            <div class="col-md-3 mb-8">
                <label for="sortFiles" class="form-label">Sort by</label>
                <select id="sortFiles" class="form-select">
                    <option value="name">Name</option>
                    <option value="uploaded">Uploaded</option>
                    <option value="size">Size</option>
                    <option value="expires">Expiry</option>
                </select>
            </div>
            <div class="col-md-3 mb-8 d-flex align-items-end">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="showExpired" />
                    <label class="form-check-label" for="showExpired">Show expired files</label>
                </div>
            </div>
        </div>

        <!-- Results Table -->
        <div class="table-responsive">
            <table class="table align-middle">
                <thead>
                    <tr>
                        <th scope="col">File</th>
                        <th scope="col">Uploaded</th>
                        <th scope="col">Expires</th>
                        <th scope="col" class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @* Demo rows for the UI preview. Remove when binding real data. *@
                    
                    @if (Model != null)
                    {
                        @foreach (var file in Model.FSAR)
                        {
                            <tr>
                                <td>
                                    <div class="d-flex flex-column">
                                        <span>@file.FileName</span>
                                    </div>
                                </td>
                                <td><span class="badge-chip badge-active">@file.StartDate</span></td>
                                <td><span class="badge-chip badge-expired">@file.EndDate</span></td>
                                <td class="text-end">
                                    @if (DateTime.Now <= file.EndDate)
                                    {
                                        <a class="btn btn-outline-primary btn-sm" asp-action="FileShareDownload" asp-route-name="@file.FileName">Download</a>
                                    }
                                    else
                                    {
                                        <button class="btn btn-outline-primary btn-sm" disabled>Download</button>
                                    }
                                </td>
                            </tr>
                        }
                    }

                    @* Keep this as the empty state when there are no files:
                    <tr>
                    <td colspan="5">
                    <div class="text-center p-24 text-muted">
                    No files to display yet.
                    </div>
                    </td>
                    </tr>
                    *@
                </tbody>
            </table>
        </div>

        <!-- Pagination Placeholder -->
        <div class="d-flex justify-content-between align-items-center mt-16">
            <div class="caption text-muted">Showing 3 of 3</div>
            <div>
                <button class="btn btn-outline-secondary btn-sm" disabled>Previous</button>
                <button class="btn btn-outline-secondary btn-sm" disabled>Next</button>
            </div>
        </div>
    </div>
</div>

@* --------------------------------------------------------------------
   TODO: Enable File Library Functionality
   - Bind files authorized for the current user (name, size, uploadedAt, expiresAt, url)
   - Implement search (client or server), sort, and "show expired" filter
   - Render expiry badge chip: active / soon (< 7 days) / expired
   - Wire "Download" to real file endpoint & audit logging
   - Add pagination (server-driven preferred)
   - Respect access windows (hide or mark expired; block download when expired)
--------------------------------------------------------------------- *@
