@model J_Tutors_Web_Platform.ViewModels.EventViewModel

@{
    ViewData["Title"] = "Event Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["NavSection"] = "Admin"; // ensure Admin navbar shows
}

<!-- Scoped styles for AEventDetail only -->
<style>
    .aeventdetail, .aeventdetail .card {
        color: var(--text-color) !important;
    }

        .aeventdetail .caption, .aeventdetail .text-muted {
            color: var(--muted-text-color) !important;
        }

        .aeventdetail .form-control,
        .aeventdetail .form-select,
        .aeventdetail textarea {
            background-color: var(--surface-color) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
            padding: 10px 12px !important;
            width: 100%;
        }

            .aeventdetail .form-control::placeholder,
            .aeventdetail textarea::placeholder {
                color: var(--muted-text-color) !important;
            }

            .aeventdetail .form-control:focus,
            .aeventdetail .form-select:focus,
            .aeventdetail textarea:focus {
                outline: none !important;
                border-color: var(--primary-color) !important;
                box-shadow: 0 0 0 0.15rem var(--accent-color) !important;
            }

        /* Table theme */
        .aeventdetail .table, .aeventdetail .table th, .aeventdetail .table td {
            color: var(--text-color) !important;
            background: transparent !important;
            border-color: var(--border-color) !important;
            vertical-align: middle;
        }

            .aeventdetail .table thead th {
                border-bottom: 1px solid var(--border-color) !important;
            }

            .aeventdetail .table tbody tr + tr {
                border-top: 1px solid var(--border-color) !important;
            }

            .aeventdetail .table tbody tr:hover {
                background: rgba(0,0,0,0.03);
            }

        /* Chips */
        .aeventdetail .chip {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            border: 1px solid var(--border-color);
            white-space: nowrap;
        }

        .aeventdetail .chip-open {
            color: var(--success-color);
            border-color: var(--success-color);
        }

        .aeventdetail .chip-ended {
            color: var(--warning-color);
            border-color: var(--warning-color);
        }

        .aeventdetail .chip-completed {
            color: var(--info-color);
            border-color: var(--info-color);
        }

        .aeventdetail .chip-full {
            color: var(--error-color);
            border-color: var(--error-color);
        }

        /* Stepper (visual only) */
        .aeventdetail .stepper {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .aeventdetail .step {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 10px;
            text-align: center;
            background: var(--surface-color);
        }

            .aeventdetail .step .num {
                display: inline-block;
                width: 22px;
                height: 22px;
                border-radius: 999px;
                border: 1px solid var(--border-color);
                line-height: 20px;
                font-weight: 700;
                margin-right: 6px;
            }

            .aeventdetail .step.active {
                border-color: var(--primary-color);
                box-shadow: 0 0 0 0.15rem var(--accent-color);
            }

        /* Roster checkboxes grouping */
        .aeventdetail .roster-list .form-check {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 8px;
            background: var(--surface-color);
        }

        /* Buttons */
        .aeventdetail .btn-sm {
            min-width: 96px;
        }
</style>

<div class="aeventdetail">

    <!-- Header / Back -->
    <div class="d-flex justify-content-between align-items-center mb-16">
        <h1 class="mb-0">Manage Event</h1>
        <a asp-controller="Admin" asp-action="AEvents" class="btn btn-secondary">← Back to Events</a>
    </div>

    <!-- TOP: Event Basics (edit) + Summary / Quick actions -->
    <div class="row g-3 mb-16">
        <div class="col-lg-16">
            <div class="card shadow p-24 h-100">
                @foreach (var evnt in Model.Events)
                {
                    <form asp-action="UpdateEvent" asp-controller="Event">
                        <h4>Create Event (UI only for now)</h4>
                        <div class="row g-3">
                            <input type="hidden" name="EventID" value="@evnt.EventID" />
                            <div class="col-lg-6">
                                <label class="form-label" for="evName">Event Name</label>
                                <input id="evName" name="Title" value="@evnt.Title" class="form-control" placeholder="Event 8" />
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label" for="evLocation">Location</label>
                                <input id="evLocation" name="Location" value="@evnt.Location" class="form-control" placeholder="Community Centre" />
                            </div>
                            <div class="col-6 col-lg-4">
                                <label class="form-label" for="evDate">Date</label>
                                <input id="evDate" name="EventDate" value="@evnt.EventDate" type="datetime" class="form-control" />
                            </div>
                            <div class="col-6 col-lg-4">
                                <label class="form-label" for="evStart">Start</label>
                                <input id="evStart" name="StartTime" value="@evnt.StartTime" type="time" class="form-control" />
                            </div>
                            <div class="col-6 col-lg-4">
                                <label class="form-label" for="evDuration">Duration (minutes)</label>
                                <input id="evDuration" name="DurationMinutes" value="@evnt.DurationMinutes" type="number" class="form-control" placeholder="120" />
                            </div>
                            <div class="col-6 col-lg-4">
                                <label class="form-label" for="evPoints">Points Reward</label>
                                <input id="evPoints" name="PointsReward" value="@evnt.PointsReward" type="number" class="form-control" placeholder="25" />
                            </div>
                            <div class="col-6 col-lg-4">
                                <label class="form-label" for="evGoal">Goal Participants</label>
                                <input id="evGoal" name="GoalParticipants" value="@evnt.GoalParticipants" type="number" class="form-control" placeholder="20" />
                            </div>
                            <div class="col-12">
                                <label class="form-label" for="evDescription">Description</label>
                                <textarea id="evDescription" name="Description" rows="3" class="form-control">@evnt.Description</textarea>
                            </div>
                            <div class="col-8">
                                <label class="form-label" for="evWhatsappURL">Whatsapp group URL</label>
                                <input id="evWhatsappURL" name="WhatsappGroupUrl" value="@evnt.WhatsappGroupUrl" type="text" class="form-control" placeholder="placeholder.url" />
                            </div>
                            <div class="col-4">
                                <label class="form-label" for="evStatus">Status</label>
                                <select id="evStatus" name="Status">
                                    <option value="Draft">Draft</option>
                                    <option value="Published">Published</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div class="col-12 d-flex gap-2">
                                <button type="submit" class="btn btn-primary">Save</button>
                            </div>
                        </div>
                    </form>
                }

                @* ===== DEMO DATA (replace when wiring) ===== *@
                
                @* ===== /DEMO DATA =========================== *@
            </div>
        </div>
    <!-- PARTICIPANTS: Applied vs Enrolled -->
    <div class="row g-3 mb-16">
        <div class="col-lg-6">
            <div class="card shadow p-24 h-100">
                <div class="d-flex justify-content-between align-items-center mb-8">
                    <h3 class="mb-0">Applied</h3>
                    <span class="chip">3</span>
                </div>

                @* ===== DEMO DATA (Applied) ===== *@
                <div class="table-responsive">
                    <table class="table align-middle">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Requested</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Student 11</strong></td>
                                <td class="caption">2025-10-01 10:05</td>
                                <td class="text-end">
                                    <a asp-controller="Admin" asp-action="AUserDetails" asp-route-id="11" class="btn btn-sm btn-outline-secondary">View</a>
                                    <button class="btn btn-sm btn-outline-primary" disabled>Enroll</button>
                                    <button class="btn btn-sm btn-outline-secondary" disabled>Deny</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Student 12</strong></td>
                                <td class="caption">2025-10-01 11:40</td>
                                <td class="text-end">
                                    <a asp-controller="Admin" asp-action="AUserDetails" asp-route-id="12" class="btn btn-sm btn-outline-secondary">View</a>
                                    <button class="btn btn-sm btn-outline-primary" disabled>Enroll</button>
                                    <button class="btn btn-sm btn-outline-secondary" disabled>Deny</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Student 13</strong></td>
                                <td class="caption">2025-10-02 08:22</td>
                                <td class="text-end">
                                    <a asp-controller="Admin" asp-action="AUserDetails" asp-route-id="13" class="btn btn-sm btn-outline-secondary">View</a>
                                    <button class="btn btn-sm btn-outline-primary" disabled>Enroll</button>
                                    <button class="btn btn-sm btn-outline-secondary" disabled>Deny</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                @* ===== /DEMO DATA ===== *@
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card shadow p-24 h-100">
                <div class="d-flex justify-content-between align-items-center mb-8">
                    <h3 class="mb-0">Enrolled</h3>
                    <span class="chip">12</span>
                </div>

                @* ===== DEMO DATA (Enrolled) ===== *@
                <div class="table-responsive">
                    <table class="table align-middle">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Joined</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Student 1</strong></td>
                                <td class="caption">2025-09-28 09:11</td>
                                <td class="text-end">
                                    <a asp-controller="Admin" asp-action="AUserDetails" asp-route-id="1" class="btn btn-sm btn-outline-secondary">View</a>
                                    <button class="btn btn-sm btn-outline-secondary" disabled>Remove</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Student 2</strong></td>
                                <td class="caption">2025-09-28 09:30</td>
                                <td class="text-end">
                                    <a asp-controller="Admin" asp-action="AUserDetails" asp-route-id="2" class="btn btn-sm btn-outline-secondary">View</a>
                                    <button class="btn btn-sm btn-outline-secondary" disabled>Remove</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Student 3</strong></td>
                                <td class="caption">2025-09-28 10:02</td>
                                <td class="text-end">
                                    <a asp-controller="Admin" asp-action="AUserDetails" asp-route-id="3" class="btn btn-sm btn-outline-secondary">View</a>
                                    <button class="btn btn-sm btn-outline-secondary" disabled>Remove</button>
                                </td>
                            </tr>
                            @* ... replicate to Student 12 for demo if needed *@
                        </tbody>
                    </table>
                </div>
                @* ===== /DEMO DATA ===== *@
            </div>
        </div>
    </div>

    <!-- CLOSE EVENT: Semi-Automated Points Flow -->
    <div class="card shadow p-24">
        <div class="d-flex justify-content-between align-items-center mb-12">
            <h3 class="mb-0">Close Event</h3>
            <div class="caption">Semi-automated points allocation</div>
        </div>


        <!-- Step 1: Review Roster -->
        <div class="mb-16">
            <h4 class="mb-8">Step 1 — Review Roster</h4>
            <div class="caption mb-8">All enrolled participants are pre-checked as “Attended”. Uncheck any no-shows.</div>

            @* ===== DEMO DATA: Enrolled roster with attendance toggles ===== *@
            <div class="roster-list">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="att1" checked disabled>
                    <label class="form-check-label" for="att1"><strong>Student 1</strong> — Attended</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="att2" checked disabled>
                    <label class="form-check-label" for="att2"><strong>Student 2</strong> — Attended</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="att3" disabled>
                    <label class="form-check-label" for="att3"><strong>Student 3</strong> — No-show</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="att4" checked disabled>
                    <label class="form-check-label" for="att4"><strong>Student 4</strong> — Attended</label>
                </div>
            </div>
            @* ===== /DEMO DATA ============================================ *@

            <div class="mt-12 d-flex gap-2">
                <button class="btn btn-primary" disabled>Next: Preview Allocation</button>
                <button class="btn btn-outline-secondary" disabled>Cancel</button>
            </div>
        </div>

        <hr />

        <!-- Step 2: Preview Allocation (UI preview only) -->
        <div class="mb-16">
            <h4 class="mb-8">Step 2 — Preview Allocation</h4>
            <div class="table-responsive">
                <table class="table align-middle">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th class="text-end">Points (default 25)</th>
                            <th class="text-end">Adjust</th>
                        </tr>
                    </thead>
                    <tbody>
                        @* ===== DEMO DATA: Only attended students listed ===== *@
                        <tr>
                            <td><strong>Student 1</strong></td>
                            <td class="text-end">25</td>
                            <td class="text-end"><input type="number" class="form-control" style="max-width:96px; display:inline-block" value="25" disabled /></td>
                        </tr>
                        <tr>
                            <td><strong>Student 2</strong></td>
                            <td class="text-end">25</td>
                            <td class="text-end"><input type="number" class="form-control" style="max-width:96px; display:inline-block" value="25" disabled /></td>
                        </tr>
                        <tr>
                            <td><strong>Student 4</strong></td>
                            <td class="text-end">25</td>
                            <td class="text-end"><input type="number" class="form-control" style="max-width:96px; display:inline-block" value="25" disabled /></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="d-flex justify-content-between mt-8">
                <div class="caption">Attendees: 3</div>
                <div><strong>Total to Allocate:</strong> 75</div>
            </div>


        </div>

        <hr />

        <!-- Step 3: Generate Receipts -->
        <div class="mb-16">
            <h4 class="mb-8">Step 3 — Generate Receipts</h4>
            <p class="caption">This will create a receipt per attendee and queue notifications.</p>
            <div class="mt-12 d-flex gap-2">
                <button class="btn btn-primary" disabled>Confirm Receipt Generation</button>
                <button class="btn btn-outline-secondary" disabled>Back</button>
            </div>
        </div>

        <hr />

        <!-- Step 4: Confirm & Notify -->
        <div>
            <h4 class="mb-8">Step 4 — Confirm &amp; Notify</h4>
            <p class="caption">Finalize the event and notify attendees. You’ll be able to view entries in the Points Ledger.</p>
            <div class="mt-12 d-flex gap-2">
                <button class="btn btn-primary" disabled>Finish</button>
                <a asp-controller="Admin" asp-action="AEvents" class="btn btn-outline-secondary">Close</a>
            </div>
        </div>
    </div>
</div>

@* --------------------------------------------------------------------
   TODO: Wire Up AEventDetail (Manage & Close)
   - Load event by id; bind basics (name, date/time, location, reward, goal, status, description)
   - CRUD: Save changes; delete with confirm
   - Participants:
       • Fetch applied & enrolled lists
       • Enroll / Deny (applied) ; Remove (enrolled)
       • Link to AUserDetails(userId)
   - Close Event flow:
       • Step 1: pull enrolled; toggle attendance (persist temp state)
       • Step 2: compute allocation, allow per-user adjustment
       • Step 3: generate receipts (create ledger entries)
       • Step 4: finalize, mark event Completed; send notifications
   - Security: admin-only guard
--------------------------------------------------------------------- *@
