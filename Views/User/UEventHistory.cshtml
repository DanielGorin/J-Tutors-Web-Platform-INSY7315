@model J_Tutors_Web_Platform.ViewModels.EventViewModel
@using J_Tutors_Web_Platform.Models.Shared

@{
    ViewData["Title"] = "Events History";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["NavSection"] = "User";
}

<!-- Scoped styles for Events History only -->
<style>
    .uevent-history .form-control,
    .uevent-history select {
        background-color: var(--surface-color) !important;
        color: var(--text-color) !important;
        border: 1px solid var(--border-color) !important;
        border-radius: 8px !important;
        padding: 10px 12px !important;
        width: 100%;
    }

        .uevent-history .form-control::placeholder {
            color: var(--muted-text-color) !important;
        }

        .uevent-history .form-control:focus,
        .uevent-history select:focus {
            outline: none !important;
            border-color: var(--primary-color) !important;
            box-shadow: 0 0 0 0.15rem var(--accent-color) !important;
        }

    /* Status chips */
    .uevent-history .chip {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid var(--border-color);
        margin: 0;
    }

    .uevent-history .chip-completed {
        color: var(--success-color);
        border-color: var(--success-color);
    }

    .uevent-history .chip-missed {
        color: var(--error-color);
        border-color: var(--error-color);
    }

    .uevent-history .chip-cancelled {
        color: var(--warning-color);
        border-color: var(--warning-color);
    }

    /* Dark-mode legibility: apply theme tokens to all key bits */
    .uevent-history,
    .uevent-history .card {
        color: var(--text-color) !important;
    }

        .uevent-history .caption,
        .uevent-history .text-muted {
            color: var(--muted-text-color) !important;
        }

        .uevent-history .table,
        .uevent-history .table th,
        .uevent-history .table td {
            color: var(--text-color) !important;
            background-color: transparent !important;
            border-color: var(--border-color) !important;
        }

            .uevent-history .table thead th {
                border-bottom: 1px solid var(--border-color) !important;
            }

            .uevent-history .table tbody tr + tr {
                border-top: 1px solid var(--border-color) !important;
            }

        .uevent-history strong {
            color: var(--text-color) !important;
        }

        /* Optional subtle row hover that works in both themes */
        .uevent-history .table tbody tr:hover {
            background: rgba(0,0,0,0.03);
        }
</style>

<div class="uevent-history">

    <!-- Header / Nav -->
    <div class="d-flex justify-content-between align-items-center mb-16">
        <h1 class="mb-0">Events History</h1>
        <div class="d-flex gap-2">
            <a asp-controller="Home" asp-action="Dashboard" class="btn btn-secondary">← Back to Dashboard</a>
            <a asp-controller="Home" asp-action="UEvents" class="btn btn-outline-primary">New Events</a>
        </div>
    </div>

    <!-- Filters -->
    <div class="card shadow p-24 mb-16">
        <div class="row g-3">
            <div class="col-lg-4">
                <label for="searchHistory" class="form-label">Search</label>
                <input id="searchHistory" type="text" class="form-control" placeholder="Search by title or description" />
            </div>
            <div class="col-6 col-lg-2">
                <label for="dateFrom" class="form-label">From</label>
                <input id="dateFrom" type="date" class="form-control" />
            </div>
            <div class="col-6 col-lg-2">
                <label for="dateTo" class="form-label">To</label>
                <input id="dateTo" type="date" class="form-control" />
            </div>
            <div class="col-6 col-lg-2">
                <label for="statusFilter" class="form-label">Status</label>
                <select id="statusFilter" class="form-select">
                    <option value="all">All</option>
                    <option value="completed">Completed</option>
                    <option value="missed">No-Show</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>
            <div class="col-6 col-lg-2">
                <label for="pointsFilter" class="form-label">Points</label>
                <select id="pointsFilter" class="form-select">
                    <option value="all">All</option>
                    <option value="earned">Earned &gt; 0</option>
                    <option value="zero">0 Points</option>
                </select>
            </div>
        </div>
        <div class="d-flex justify-content-end mt-16">
            <button class="btn btn-outline-primary" disabled>Apply Filters</button>
        </div>
    </div>

    <!-- Inactive Events Table -->
    <div class="card shadow p-24">
        <div class="table-responsive">
            <table class="table align-middle">
                <thead>
                    <tr>
                        <th>Event</th>
                        <th>Location</th>
                        <th>Date</th>
                        <th>Start</th>
                        <th>Duration</th>
                        <th>Status</th>
                        <th>Points Earned</th>
                        <th class="text-end">Receipt</th>
                    </tr>
                </thead>
                <tbody>
                    @* Empty state 
                    <tr>
                        <td colspan="7">
                            <div class="text-center p-24 text-muted">No historical events to display yet.</div>
                        </td>
                    </tr>*@

                    @* --------------------------------------------------------------
                    Example row structure (REFERENCE ONLY — do not render now)*@

                    @if (Model != null)
                    {
                        @foreach (var evnt in Model.DetailedEventRows)
                        {
                            @if (evnt.Status != EventStatus.Draft)
                            {
                                <tr>
                                    <td>
                                        <div class="d-flex flex-column">
                                            <strong>@evnt.Title</strong>
                                            <span class="caption">@evnt.Description</span>
                                        </div>
                                    </td>
                                    <td>@evnt.Location</td>
                                    <td>@evnt.EventDate</td>
                                    <td>@evnt.StartTime</td>

                                    @if (evnt.Status == EventStatus.Cancelled)
                                    {
                                        <td><span class="chip chip-completed">Cancelled</span></td>
                                        <td>0</td>
                                    }
                                    @if ((evnt.Status == EventStatus.Published))
                                    {
                                        <td><span class="chip chip-completed">Completed</span></td>
                                        <td>@evnt.PointsReward</td>
                                    }
                                    @if ((evnt.Status == EventStatus.Completed))
                                    {
                                        <td><span class="chip chip-completed">Completed</span></td>
                                        <td>@evnt.PointsReward</td>
                                    }

                                    <td class="text-end">
                                        <a class="btn btn-sm btn-outline-primary">View Receipt</a>
                                    </td>
                                </tr>
                            }
                        }
                    }
                    
                    @* -------------------------------------------------------------- *@
                </tbody>
            </table>
        </div>

        <!-- Pagination Placeholder -->
        <div class="d-flex justify-content-between align-items-center mt-16">
            <div class="caption text-muted">Showing 0 of 0</div>
            <div>
                <button class="btn btn-outline-secondary btn-sm" disabled>Previous</button>
                <button class="btn btn-outline-secondary btn-sm" disabled>Next</button>
            </div>
        </div>
    </div>
</div>

@* --------------------------------------------------------------------
   TODO: Enable Events History Functionality
   - Bind user's past events with: title, description, date, startTime,
     duration, status (completed/missed/cancelled), pointsEarned, receiptId
   - Implement filters: text query, date range, status, points
   - Sort by date (desc/asc); server-driven pagination
   - "View Receipt" → open receipt detail or download (and audit)
   - Auth guard: require sign-in
--------------------------------------------------------------------- *@
