@model J_Tutors_Web_Platform.ViewModels.AFilesViewModel

@{
    ViewData["Title"] = "Manage File";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["NavSection"] = "Admin";
}

<!-- Scoped styles for file management -->
<style>
    .afiles, .afiles .card {
        color: var(--text-color) !important;
    }

        .afiles .caption, .afiles .text-muted {
            color: var(--muted-text-color) !important;
        }

        .afiles .form-control, .afiles .form-select, .afiles textarea {
            background-color: var(--surface-color) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
            padding: 10px 12px !important;
            width: 100%;
        }

            .afiles .form-control::placeholder, .afiles textarea::placeholder {
                color: var(--muted-text-color) !important;
            }

            .afiles .form-control:focus, .afiles .form-select:focus, .afiles textarea:focus {
                outline: none !important;
                border-color: var(--primary-color) !important;
                box-shadow: 0 0 0 0.15rem var(--accent-color) !important;
            }

        /* Table theme */
        .afiles .table, .afiles .table th, .afiles .table td {
            color: var(--text-color) !important;
            background: transparent !important;
            border-color: var(--border-color) !important;
            vertical-align: middle;
        }

            .afiles .table thead th {
                border-bottom: 1px solid var(--border-color) !important;
            }

            .afiles .table tbody tr + tr {
                border-top: 1px solid var(--border-color) !important;
            }

            .afiles .table tbody tr:hover {
                background: rgba(0,0,0,0.03);
            }

        /* Chips / Badges */
        .afiles .badge-chip {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            border: 1px solid var(--border-color);
            white-space: nowrap;
        }

        .afiles .badge-active {
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .afiles .badge-soon {
            border-color: var(--warning-color);
            color: var(--warning-color);
        }

        .afiles .badge-expired {
            border-color: var(--error-color);
            color: var(--error-color);
        }

        /* Upload drop zone (visual only) */
        .afiles .drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            background: var(--surface-color);
        }

            .afiles .drop-zone:hover {
                border-color: var(--primary-color);
            }

        /* Modal list items */
        .afiles .access-item {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 8px;
            background: var(--surface-color);
        }
</style>

<div class="afiles">
    <!-- Header / Back -->
    <div class="d-flex justify-content-between align-items-center mb-16">
        <h1 class="mb-0">Files (Admin)</h1>
        <a asp-controller="Admin" asp-action="ADashboard" class="btn btn-secondary">← Back to Dashboard</a>
    </div>

    <div class="row g-3">
        <!-- LEFT: Library (filters + table) -->
        <div class="col-lg-8">
            <div class="card shadow p-24 mb-16">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label" for="fileSearch">Search</label>
                        <input id="fileSearch" class="form-control" placeholder="Search by name or description" />
                    </div>
                    <div class="col-6 col-md-3">
                        <label class="form-label" for="fileSort">Sort by</label>
                        <select id="fileSort" class="form-select">
                            <option value="uploaded">Uploaded</option>
                            <option value="name">Name</option>
                            <option value="size">Size</option>
                            <option value="expiry">Expiry</option>
                        </select>
                    </div>
                    <div class="col-6 col-md-3 d-flex align-items-end">
                        <div class="form-check">
                            <input id="showExpired" class="form-check-input" type="checkbox" />
                            <label for="showExpired" class="form-check-label">Show expired</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow p-24">
                <div class="table-responsive">
                    <table class="table align-middle">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Access From</th>
                                <th>Access Till</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var file in Model.FSAR) //not completed
                            {
                                <tr>
                                    <form>
                                    <td>
                                        <div class="d-flex flex-column">
                                            <strong>@file.Username</strong>
                                        </div>
                                    </td>
                                    <td class="text-center"><span type="date" name="StartDate" class="badge-chip badge-active">@file.StartDate</span></td>
                                    <td class="text-center"><span type="date" name="EndDate" class="badge-chip badge-active">@file.EndDate</span></td>
                                    <td class="text-end">
                                        <input type="hidden" name="FileID" value="@file.FileID" />
                                        <input type="hidden" name="UserID" value="@file.UserID" />
                                        <button type="submit" class="btn btn-sm btn-outline-danger mt-2">Save Changes</button>
                                            
                                        <form>
                                            <input type="hidden" name="FileID" value="@file.FileID" />
                                            <input type="hidden" name="UserID" value="@file.UserID" />
                                            <button type="submit" class="btn btn-sm btn-outline-danger mt-2">Remove Access</button>
                                        </form>
                                    </td>
                                    </form>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <!-- Pagination placeholder -->
                <div class="d-flex justify-content-between align-items-center mt-16">
                    <div class="caption text-muted">Showing 3 of 3</div>
                    <div>
                        <button class="btn btn-outline-secondary btn-sm" disabled>Previous</button>
                        <button class="btn btn-outline-secondary btn-sm" disabled>Next</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT: Upload + Tips -->
        <div class="col-lg-4">
            <div class="card shadow p-24 mb-16">
                <form asp-action="AddFileAccess" method="post" enctype="multipart/form-data" class="mb-3">
                    <div class="drop-zone mb-12">
                        <input type="text" name="Username" class="form-control" />
                        <input type="hidden" name="FileID" value="@Model.CurrentFileID" class="form-control" />
                        <input type="datetime-local" name="StartDate" class="form-control mt-2" />
                        <input type="datetime-local" name="EndDate" class="form-control mt-2" />
                        <button class="btn btn-primary mt-2" type="submit">Give Access</button>
                    </div>
                </form>
            </div>

            <div class="card shadow p-24">
                <h3 class="mb-8">Access Tips</h3>
                <ul class="mb-0">
                    <li class="mb-8">Use <em>Manage Access</em> to choose students and set expiry windows.</li>
                    <li class="mb-8">Expired access should block downloads automatically (future).</li>
                    <li class="mb-0">Auditing of downloads will appear here in future.</li>
                </ul>
            </div>
        </div>
    </div>
</div>
